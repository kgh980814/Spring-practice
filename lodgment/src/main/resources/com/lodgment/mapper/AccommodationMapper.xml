<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lodgment.mapper.AccommodationMapper">
<!-- 반복되는 서브쿼리(예약불가 객실 수 조회) 묶기-->
	<sql id="getReservedCountByRoomNo">
		select room_no, count(*) as cnt
			from reservation r, payment p
			where (reservation_check_in = #{startDate}
				or (reservation_check_in &lt; #{startDate} and reservation_check_out &gt; #{startDate})
				or (reservation_check_in &gt; #{startDate} and reservation_check_in &lt; #{endDate}))
				and r.reservation_id = p.reservation_id
				and p.payment_status = '예약완료'
			group by room_no
	</sql>
	
	<!-- List<AccommodationType> getAllTypes(); -->
	<select id="getAllTypes" resultType="com.lodgment.domain.AccommodationType">
		select acco_type_id as id, acco_type_name as name
		from accommodation_types
		order by acco_type_id
	</select>
	
	<!-- List<City> getAllCities(); -->
	<select id="getAllCities" resultType="com.lodgment.domain.City">
		select city_id as id, city_name as name, city_latitude as latitude, city_longitude as longitude
		from cities
		order by city_id
	</select>
	
	<!-- String getTypeNameById(String typeId); -->
	<select id="getTypeNameById" parameterType="string" resultType="string">
		select acco_type_name
		from accommodation_types
		where acco_type_id = #{value}
	</select>
	
	<select id="getCommonFacilitiesByAccoType" parameterType="string" resultType="com.lodgment.domain.CommonFacility">
		select co_facility_id as id, co_facility_name as name, co_facility_icon_name as iconName
		from common_facilities
		where co_facility_id in (select co_facility_id from acco_type_cofa where acco_type_id = #{value})
		order by co_facility_id
	</select>
	
	<!-- List<RoomFacility> getAllRoomFacilities(); -->	
	<select id="getAllRoomFacilities" resultType="com.lodgment.domain.RoomFacility">
		select ro_facility_id as id, ro_facility_name as name, ro_facility_icon_name as iconName
		from room_facilities
		order by ro_facility_id
	</select>
	
	<!-- List<String> getAllAccoTagsByAccoType(String typeId) -->
	<select id="getAllAccoTagsByAccoType" parameterType="string" resultType="string">
		select acco_tag
		from acco_tags
		where acco_id in (select acco_id from acco_types where acco_type_id = #{value}) 
	</select>
	
	<!-- List<String> getAllAccoTags(); -->
	<select id="getAllAccoTags" resultType="string">
		select acco_tag
		from acco_tags
		order by acco_tag
	</select>
	
</mapper>